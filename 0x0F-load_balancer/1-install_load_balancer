#!/usr/bin/env bash
# Installs and sets up HAProxy on Ubuntu

# Update and install software-properties-common
sudo apt-get -y update
sudo apt-get -y install software-properties-common

# Add HAProxy repository
sudo add-apt-repository -y ppa:vbernat/haproxy-2.4

# Update package list
sudo apt-get -y update

# Install HAProxy
sudo apt-get -y install haproxy

# Enable HAProxy to start on boot
sudo systemctl enable haproxy

# Configure HAProxy to load balance between web-01 and web-02
sudo tee -a /etc/haproxy/haproxy.cfg > /dev/null <<EOL
listen load_balancer
    bind *:80
    mode http
    balance roundrobin
    option httpclose
    option forwardfor
    server 448078-web-01 100.26.159.155:80 check
    server 448078-web-02 100.26.122.170:80 check
EOL

# Restart HAProxy service
sudo systemctl restart haproxy

